<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>1 Lion eSports ‚Äî Registration & Payment</title>
<style>
  :root { --gold:#ffd166; --bg:#000; --card:#0f0f12; --muted:#dcdcdc; --green:#25D366; }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter, Arial, Helvetica, sans-serif;
    background:linear-gradient(180deg,#000,#070707); color:var(--muted);
    -webkit-font-smoothing:antialiased; text-align:center; padding:18px 12px 60px;
  }

  /* header */
  .header{max-width:980px;margin:0 auto 14px;display:flex;align-items:center;gap:12px;justify-content:center}
  img.logo{width:96px;height:auto;border-radius:10px;box-shadow:0 10px 30px rgba(255,209,77,0.06)}
  h1{color:var(--gold);margin:0;font-size:20px}

  /* card */
  .card{max-width:460px;margin:14px auto;padding:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;border:1px solid rgba(255,209,77,0.06)}
  .field{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:0;background:#0b0b0d;color:#fff;font-size:15px}
  .btn{width:100%;padding:12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--gold),#e6b800);color:#000;font-weight:700;font-size:16px;cursor:pointer}
  .muted{color:#bfbfbf;font-size:13px;margin-top:8px}

  /* payment section */
  .payment{max-width:520px;margin:18px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,215,0,0.02), rgba(255,215,0,0.01)); border-top:3px solid rgba(255,215,0,0.06)}
  .qr{width:220px;height:220px;object-fit:contain;border-radius:8px;background:#fff;padding:8px}
  .copyRow{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px}
  .smallBtn{padding:8px 12px;border-radius:8px;border:0;background:rgba(0,0,0,0.7);color:white;cursor:pointer}
  .tx{width:100%;padding:10px;margin-top:12px;border-radius:8px;border:0;background:#0b0b0d;color:#fff}

  /* verifying & success */
  .center{display:flex;align-items:center;justify-content:center;gap:12px}
  .hidden{display:none}
  .verifying{font-size:16px;color:var(--muted)}
  /* success animation */
  .successWrap{max-width:640px;margin:20px auto;padding:18px;border-radius:12px;background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4));border:1px solid rgba(0,0,0,0.2)}
  .check {
    width:120px;height:120px;border-radius:60px;background:linear-gradient(180deg,#22c55e,#159e3b);
    display:flex;align-items:center;justify-content:center;margin:0 auto 12px;
    box-shadow:0 12px 30px rgba(21,158,59,0.18);
    transform:scale(0);animation:pop 600ms cubic-bezier(.2,.9,.3,1) forwards;
  }
  .check svg{width:64px;height:64px;fill:white}
  @keyframes pop{0%{transform:scale(0)}60%{transform:scale(1.12)}100%{transform:scale(1)}}

  /* whatsapp button */
  .waBtn{display:inline-block;background:var(--green);color:#fff;padding:12px 18px;border-radius:8px;text-decoration:none;font-weight:700;margin-top:12px}

  /* rules */
  .rules{max-width:900px;margin:22px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,215,0,0.02), rgba(255,215,0,0.01));border-top:3px solid rgba(255,215,0,0.12);text-align:left;color:#eee}
  .rules h2{color:var(--gold);margin:0 0 8px}
  .rules h3{margin:10px 0 6px;color:var(--gold);font-size:15px}
  .rules ul,.rules ol{margin:6px 0 12px 20px;color:#ddd}
  .rules p{margin:6px 0;color:#ddd;font-size:14px}
  @media (max-width:420px){ .card{padding:14px} img.logo{width:80px} .qr{width:180px;height:180px} }
</style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <!-- Primary: use uploaded logo file (logo.png). Fallback to hosted image if not found -->
    <img class="logo" id="logo" src="logo.png" alt="1 Lion eSports Logo"
         onerror="this.onerror=null; this.src='https://i.postimg.cc/23d0f0rK/logo.png'">
    <div>
      <h1>1 Lion eSports</h1>
      <div class="muted">Tournament Registration ‚Äî ‚Çπ30 Entry</div>
    </div>
  </div>

  <!-- REGISTRATION FORM -->
  <div class="card" id="formCard">
    <form id="regForm" autocomplete="off">
      <input class="field" id="origName" name="origName" placeholder="Original Name" required>
      <input class="field" id="inGame" name="inGame" placeholder="In-Game Name (FF MAX account name)" required>
      <input class="field" id="uid" name="uid" placeholder="UID" required>
      <input class="field" id="mobile" name="mobile" placeholder="Mobile Number (with country code if outside India)" required>
      <button class="btn" id="submitBtn" type="submit">Register & Proceed to Payment ‚Çπ30</button>
      <div id="formNote" class="muted">After registration you will be shown a QR to complete payment. Keep Txn ID handy.</div>
    </form>
  </div>

  <!-- PAYMENT STEP (shows after registration) -->
  <div id="paymentCard" class="payment hidden">
    <h3>Scan QR or pay using UPI ID</h3>
    <!-- Primary: use uploaded qr.png. Fallback: generate QR URL from api.qrserver -->
    <img id="qrImg" class="qr" src="qr.png"
         alt="Payment QR" onerror="this.onerror=null; this.src='https://api.qrserver.com/v1/create-qr-code/?data=upi://pay?pa=acharya107@fam&am=30&cu=INR&size=300x300'">
    <div style="margin-top:10px"><strong>UPI ID:</strong> <span id="upiText">acharya107@fam</span></div>

    <div class="copyRow">
      <button class="smallBtn" onclick="copyText('#upiText')">Copy UPI ID</button>
      <button class="smallBtn" onclick="showQrForShare()">Share QR</button>
    </div>

    <input id="txnInput" class="tx" type="text" placeholder="Enter Transaction ID (from your UPI app)" />
    <button class="btn" id="verifyBtn" onclick="verifyTxn()">Verify Payment</button>
    <div id="payStatus" class="muted" style="margin-top:8px"></div>
  </div>

  <!-- VERIFYING -->
  <div id="verifyingCard" class="hidden card center" style="max-width:360px">
    <div class="verifying">Checking payment ‚Äî please wait...</div>
  </div>

  <!-- SUCCESS -->
  <div id="successCard" class="hidden successWrap" style="text-align:center">
    <div class="check" id="checkAnim">
      <!-- tick -->
      <svg viewBox="0 0 24 24"><path d="M20.285 6.708a1 1 0 0 0-1.414-1.415l-9.192 9.193-3.192-3.192a1 1 0 0 0-1.414 1.414l3.899 3.899a1 1 0 0 0 1.414 0l10.899-10.899z"/></svg>
    </div>
    <h2 style="color:var(--gold);margin:6px 0 10px">Payment Successful</h2>
    <p style="color:#ddd;margin:0 0 12px">Thank you ‚Äî payment recorded.</p>

    <div class="notice" style="max-width:680px;margin:0 auto">
      <strong style="color:var(--gold)">IMPORTANT NOTICE</strong>
      <p style="color:#ddd;margin:8px 0 0">Message the owner on WhatsApp with your payment proof to book your slot.</p>
      <a id="waLink" class="waBtn" href="#" target="_blank" rel="noopener">Message Owner on WhatsApp</a>
    </div>
  </div>

  <!-- RULES -->
  <div class="rules" id="rulesBox">
    <h2>Rules and Regulations</h2>

    <h3>Instructions Before Joining:</h3>
    <ol>
      <li>Enter your FF MAX account name only.</li>
      <li>Do not put UID/GAME-ID and try to use simple font in your GameName.</li>
      <li>Match room ID and password will be sent 8‚Äì10 minutes before the match.</li>
    </ol>

    <h3>Eligibility Rules:</h3>
    <ol>
      <li>Only players with Level 40+ ID are allowed.</li>
      <li>Headshot rate must be ‚â§ 70% in BR career.</li>
      <li>Play only on Android, iOS, tablets, or phones (emulators are not allowed).</li>
    </ol>

    <h3>Prohibited Behavior:</h3>
    <ul>
      <li>‚ùåAimbot</li>
      <li>‚ùåNo recoil</li>
      <li>‚ùåHacking</li>
      <li>‚ùåGame modifying tools</li>
      <li>‚ùåGlitches</li>
      <li>‚ùåTeaming up with opponents</li>
      <li>‚ùåInviting unregistered players</li>
    </ul>

    <h3>Some Important Tips:</h3>
    <ol>
      <li>If player Game-ID is blacklisted, then prizes will not proceed without recording proofs. Players can be asked for proofs, so recording the game is a must.</li>
      <li>If slots are not full, then the winning prize may be changed as per the structure.</li>
      <li>If you are killed by any hacker or team-up player, record evidence for a full refund.</li>
      <li>Abusing any Player/Host will lead to an immediate ban.</li>
    </ol>

    <h3>Raise Your Query:</h3>
    <p>‚úâÔ∏èRaise issues with customer support within 2 hours of match end time.</p>

    <p><strong>Note:</strong> ‚ö†Ô∏è1 Lion eSports reserves the right to modify prizes and rules.</p>
    <p style="text-align:center;color:var(--gold);font-weight:700;margin-top:10px">ALL THE BEST PLAYERS üëç</p>
  </div>

<script>
/* ---------------- CONFIG ---------------- */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwdIpQ6Z_lZUm99ei09GWwIWrpwrb6wDPAWZOa7x5VdjdXWugZrA-ZB5kCqkkHEQLxqBA/exec";
const UPI_ID = "acharya107@fam";
const AMOUNT = "30";
const OWNER_WA = "916370027283"; // without plus
/* ---------------------------------------- */

const regForm = document.getElementById('regForm');
const paymentCard = document.getElementById('paymentCard');
const formCard = document.getElementById('formCard');
const verifyBtn = document.getElementById('verifyBtn');
const waLink = document.getElementById('waLink');
const qrImg = document.getElementById('qrImg');

function copyText(selector){
  const el = document.querySelector(selector||'#upiText');
  if(!el) return;
  const txt = (typeof el === 'string') ? el : el.textContent || el.value;
  navigator.clipboard?.writeText(txt).then(()=> alert('Copied to clipboard'));
}

function showQrForShare(){
  // fallback: open QR image in new tab so user can long-press save/share
  const src = qrImg.src;
  window.open(src, '_blank');
}

/* Build whatsapp message link */
function buildWaLink(name,uid,txn){
  const msg = `Hello Owner, I have completed the payment. Name: ${name}. UID: ${uid}. Txn ID: ${txn}. Here is my payment proof.`;
  return `https://wa.me/${OWNER_WA}?text=${encodeURIComponent(msg)}`;
}

/* Attempt to open UPI app via link (works on mobile) */
function openUpi(){
  const upi = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&pn=${encodeURIComponent('1 Lion eSports')}&am=${encodeURIComponent(AMOUNT)}&cu=INR&tn=${encodeURIComponent('Tournament Registration Fee')}`;
  // Try direct navigation
  window.location.href = upi;
  // Fallback click
  setTimeout(()=>{ const a=document.createElement('a'); a.href=upi; a.style.display='none'; document.body.appendChild(a); a.click(); setTimeout(()=>a.remove(),800); }, 300);
}

/* Submit registration -> save to Google Sheet and show QR area */
regForm.addEventListener('submit', async function(e){
  e.preventDefault();
  const data = {
    originalName: document.getElementById('origName').value.trim(),
    inGameName: document.getElementById('inGame').value.trim(),
    uid: document.getElementById('uid').value.trim(),
    mobile: document.getElementById('mobile').value.trim()
  };
  if(!data.originalName||!data.inGameName||!data.uid||!data.mobile){
    alert('Please fill all fields.');
    return;
  }

  // disable button
  document.getElementById('submitBtn').disabled = true;
  document.getElementById('submitBtn').textContent = 'Processing...';

  try{
    // POST as text/plain to reduce preflight (Apps Script will parse e.postData.contents)
    await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify(data)
    });
  }catch(err){
    console.error(err);
    alert('Network error while saving registration. Try again or contact admin.');
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('submitBtn').textContent = 'Register & Proceed to Payment ‚Çπ30';
    return;
  }

  // show payment UI
  formCard.classList.add('hidden');
  paymentCard.classList.remove('hidden');

  // set qr image src (if qr.png exists it will show; otherwise fallback generated QR)
  qrImg.src = 'qr.png';
  // ensure upi id text shows
  document.getElementById('upiText').textContent = UPI_ID;

  // auto-open UPI app on mobile (best-effort)
  setTimeout(()=> openUpi(), 700);
});

/* Verify transaction - fake 5s checking then show success + wa link */
function verifyTxn(){
  const txn = document.getElementById('txnInput').value.trim();
  if(!txn){
    alert('Please enter Transaction ID.');
    return;
  }

  // show verifying UI
  paymentCard.classList.add('hidden');
  document.getElementById('verifyingCard').classList.remove('hidden');

  // simulate 5 second check
  setTimeout(()=>{
    document.getElementById('verifyingCard').classList.add('hidden');
    document.getElementById('successCard').classList.remove('hidden');

    // animate check (CSS handles)
    // setup whatsapp link with details
    const name = document.getElementById('origName').value.trim();
    const uid  = document.getElementById('uid').value.trim();
    waLink.href = buildWaLink(name,uid,txn);

    // scroll to success area
    document.getElementById('successCard').scrollIntoView({behavior:'smooth'});
  }, 5000);
}
</script>
</body>
</html>
